<#assign wp=JspTaglibs["/aps-core"]>

    <style>
        .pdf-wrapper {
            display: flex;
            background: #404040;
            min-height: 700px;
        }
        .pdf-stuff {
            flex-grow: 10;
        }
        #pdf-viewer {
            border: none;
        }
        .form-stuff {
            flex-grow: 2;
            width: 300;
        }
        #fsi-pdf-check {
            padding: 0 10px;
            font-family: "Open Sans", sans-serif;
        }
        #fsi-pdf-check-info .semibold {
            font-weight: 600;
        }

        .fsi-pdf-check-info {
            margin-top: 35px;
        }

        .fsi-pdf-check-info .tabs-row {
            display: flex;
            flex-basis: 400px;
        }

        .fsi-pdf-check-info .tabs-row button {
            border: none;
            background: transparent;
            border-radius: 5px 5px 0 0;
            outline: 0;
            height: 35px;
            flex-grow: 1;

            font-family: "Open Sans", sans-serif;
            font-size: 14px;
            font-weight: bold;
            color: #A7B1C1;
        }

        .fsi-pdf-check-info .tabs-row button.active {
            background: #FFFFFF;
            color: #676A6C;
        }


        .fsi-pdf-check-info .tab-content {
            background: #FFFFFF;
            padding: 10px;
            color: #676A6C;
            font-size: 13px;
        }

        .fsi-pdf-check-info .tab-panel {
            display: none;
        }
        .fsi-pdf-check-info .tab-panel.active {
            display: block;
        }

        .fsi-pdf-check-info .tab-panel > div {
            margin-bottom: 5px;
        }


        .fsi-pdf-check-fields .pdf-field-row {
            margin-top: 15px;
            background: #FFFFFF;
            color: #696C6E;
            font-size: 13px;
            height: 30px;
            transition: height 300ms;

            display: flex;
            position: relative;
            overflow: hidden;
        }

        .fsi-pdf-check-fields .pdf-field .pdf-field-row:before {
            content: "?";
            font-family: "FontAwesome";
            font-size: 16px;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 0px;
            transition: width 300ms;
            background: #FFFFFF;
            color: #FFFFFF;
            width: 0px;
            overflow: hidden;
        }
        .fsi-pdf-check-fields .pdf-field.marked .pdf-field-row:before {
            width: 30px;
            transition: width 300ms;
        }
        .fsi-pdf-check-fields .pdf-field.approved .pdf-field-row:before {
            content: "\f00c";
            background: #00ab89;
        }
        .fsi-pdf-check-fields .pdf-field.rejected .pdf-field-row:before {
            content: "\f00d";
            background: #be0100;
        }

        .fsi-pdf-check-fields .pdf-field.expanded .pdf-field-row {
            height: 60px;
            transition: height 300ms;
        }

        .fsi-pdf-check-fields .pdf-field .pdf-field-labels {
            padding: 5px 10px;
        }
        .fsi-pdf-check-fields .pdf-field .pdf-field-value {
            display: none;
            font-size: 20px;
            font-weight: 300;
        }
        .fsi-pdf-check-fields .pdf-field.expanded .pdf-field-value {
            display: block;
        }

        .fsi-pdf-check-fields .pdf-field .pdf-field-tools {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 13px;
            color: #C4C4C4;
            user-select: none;
        }

        .fsi-pdf-check-fields .pdf-field .pdf-field-tools .fa {
            cursor: pointer;
        }

        .fsi-pdf-check-fields .pdf-field .approve-reject-buttons,
        .fsi-pdf-check-fields .pdf-field.expanded.marked .approve-reject-buttons {
            display: flex;
            flex-basis: 300px;
            height: 0;
            margin-top: 0;
            transition: height 300ms, margin-top 300ms;
            overflow: hidden;
        }

        .fsi-pdf-check-fields .pdf-field.expanded .approve-reject-buttons {
            height: 60px;
            margin-top: 15px;
            transition: height 300ms, margin-top 300ms;
        }


        .fsi-pdf-check-fields .approve-reject-buttons .block-btn {
            flex-grow: 1;
            border: none;
            font-size: 16px;
            color: #FFFFFF;
            height: 60px;
        }
        .fsi-pdf-check-fields .approve-reject-buttons .block-btn.reject-btn {
            background: #be0100;
        }
        .fsi-pdf-check-fields .approve-reject-buttons .block-btn.approve-btn {
            background: #00ab89;
        }

        .fsi-pdf-approve-reject .approve-form,
        .fsi-pdf-approve-reject .reject-form {
            display: none;
            margin-top: 15px;
        }
        .fsi-pdf-approve-reject .reject-form-notes {
            background: #FFFFFF;
        }
        .fsi-pdf-approve-reject .reject-form-notes .notes-title {
            padding: 15px 10px;
            margin: 0;
            border-bottom: 1px solid #C4C4C4;
        }
        .fsi-pdf-approve-reject .reject-form-notes .notes-textarea {
            padding: 15px 10px;
        }

        .fsi-pdf-approve-reject .reject-form-notes .notes-textarea textarea {
            width: 100% !important;
            height: 100% !important;
        }

        .fsi-pdf-approve-reject .big-button {
            margin: 15px 0;
            border: none;
            outline: 0;
            color: #FFFFFF;
            background: BLACK;
            width: 100%;
            height: 30px;
        }
        .fsi-pdf-approve-reject .big-button.approve-btn {
            background: #00ab89;
        }
        .fsi-pdf-approve-reject .big-button.reject-btn {
            background: #be0100;
        }

    </style>

    <script>
        $(function(){

            function getQueryVariable(variable){
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i=0;i<vars.length;i++) {
                    var pair = vars[i].split("=");
                    if(pair[0] == variable){return pair[1];}
                }
                return(false);
            };

            var loadUserInfo = function(continerId, taskId){
                //http://localhost:8080/fsi-backoffice/api/rs/en/jpkiebpm/taskInputOutput.json?
                var url = '<@wp.info key="systemParam" paramName="applicationBaseURL" />api/rs/<@wp.info key="currentLang"/>/jpkiebpm/taskInputOutput.json?containerId='+containerId+'&taskId='+taskId;
                console.log(url);
                $.get(url, function (data) {
                    var obj = data.response.result.processObj;
                    var keys = Object.keys(obj);
                    keys.forEach(function(key){
                        $('.data-field-'+key).text(obj[key]);
                    })

                    console.log(data);
                });

            };
            var containerId = getQueryVariable('containerId');
            var taskId = getQueryVariable('taskId');
            loadUserInfo(containerId,taskId);

        });

    </script>






    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>Documents check section</h5>
            <div class="ibox-tools">
                <a class="collapse-link">
                    <i class="fa fa-chevron-up"></i>
                </a>
            </div>
        </div>
        <div class="ibox-content">
            <div class="container-pdf">
                <div class="row"><br></div>
                <div class="pdf-wrapper">
                    <div class="pdf-stuff">
                        <iframe id="pdf-viewer" style="width: 100%; height: 100%;" allowfullscreen="" webkitallowfullscreen="" ></iframe>
                    </div>
                    <div class="form-stuff ">

                        <!-- ------------------------------------ PDF check -------------------------------------------- -->
                        <div id="fsi-pdf-check">

                            <div class="fsi-pdf-check-info">
                                <div class="tabs-row">
                                    <button class="active" data-tab-id="userInfo">User Info</button>
                                    <button data-tab-id="businessInfo">Business Info</button>
                                </div>
                                <div class="tab-content">
                                    <div class="tab-panel active" data-tab-id="userInfo">
                                        <div>
                                            <div class="semibold">Name</div>
                                            <div class="data-field-cname"></div>
                                        </div>
                                        <div>
                                            <div class="semibold">Phone</div>
                                            <div class="data-field-phone">-</div>
                                        </div>
                                        <div>
                                            <div class="semibold">Email</div>
                                            <div class="data-field-pemail">-</div>
                                        </div>
                                    </div>
                                    <div class="tab-panel" data-tab-id="businessInfo">
                                        <div>
                                            <div class="semibold">Company Name</div>
                                            <div class="data-field-company-name">-</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="fsi-pdf-check-fields">
                                <!-- WILL BE POPULATED WITH FIELDS -->
                            </div>

                            <div class="fsi-pdf-approve-reject">
                                <div class="approve-form">
                                    <button class="big-button approve-btn">APPROVE</button>
                                </div>
                                <div class="reject-form">
                                    <div class="reject-form-notes">
                                        <h4 class="notes-title">Notes</h4>
                                        <div class="notes-textarea">
                                            <textarea></textarea>
                                        </div>
                                    </div>
                                    <button class="big-button reject-btn">REJECT</button>
                                </div>
                            </div>

                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="text/template" id="pdf-field-template">
        <div class="pdf-field">
            <div class="pdf-field-row">
                <div class="pdf-field-labels">
                    <div class="pdf-field-name">Verify company name</div>
                    <div class="pdf-field-value">Interstellar</div>
                </div>
                <div class="pdf-field-tools">
                    <i class="expand-btn fa fa-chevron-down"></i>
                    <i class="clear-btn fa fa-times"></i>
                </div>
            </div>
            <div class="approve-reject-buttons">
                <button class="block-btn approve-btn"><i class="fa fa-check"></i></button>
                <button class="block-btn reject-btn"><i class="fa fa-times"></i></button>
            </div>
        </div>
    </script>



    <script>

        $(function () {

            var MOCK_FIELD_DATA = [
                { name: 'Company Name', value: 'Interstellar' },
                { name: 'Tax Number', value: '01002003004' },
                { name: 'Present Balance', value: '$120000' },
                { name: 'ID Number', value: '0000023452523' },
                { name: 'Address', value: 'Good Vibes st.' },
                { name: 'Province', value: 'CA' },
                { name: 'Phone', value: '001-02308262' }
            ];

            function updateApproveRejectForm() {
                var nFields = $('.pdf-field').length,
                    nApproved = $('.pdf-field.approved').length,
                    nRejected = $('.pdf-field.rejected').length;

                if (nRejected > 0) {
                    $('.approve-form').hide();
                    $('.reject-form').show();
                } else if (nFields === nApproved) {
                    $('.reject-form').hide();
                    $('.approve-form').show();
                } else {
                    $('.reject-form').hide();
                    $('.approve-form').hide();
                }
            }

            function toggleFieldExpand(fieldElem) {
                var expandBtn = $(fieldElem).find('.expand-btn');
                expandBtn.removeClass('fa-chevron-up fa-chevron-down');
                $(fieldElem).toggleClass('expanded');
                if ($(fieldElem).hasClass('expanded')) {
                    expandBtn.addClass('fa-chevron-up');
                } else {
                    expandBtn.addClass('fa-chevron-down');
                }
            }

            // creating fields
            var fieldListElem = $('.fsi-pdf-check-fields');
            MOCK_FIELD_DATA.forEach(function(field) {
                var fieldElem = $($('#pdf-field-template').html());
                fieldElem.find('.pdf-field-name').text(field.name);
                fieldElem.find('.pdf-field-value').text(field.value);
                fieldListElem.append(fieldElem);
            });


            // binding info tabs
            $('button[data-tab-id]').click(function() {
                $('[data-tab-id]').removeClass('active');
                var tabId = $(this).attr('data-tab-id');
                $('[data-tab-id="' + tabId + '"]').addClass('active');
            });

            // binding expanding fields
            $('.pdf-field .expand-btn').click(function() {
                var field = $(this).closest('.pdf-field');
                toggleFieldExpand(field);
            });

            // binding clear field buttons
            $('.pdf-field .clear-btn').click(function() {
                var field = $(this).closest('.pdf-field');
                field.removeClass('marked approved rejected');
                updateApproveRejectForm();
            });

            // binding approve buttons
            $('.pdf-field .approve-btn').click(function() {
                var field = $(this).closest('.pdf-field');
                toggleFieldExpand(field);
                field.addClass('marked approved');
                updateApproveRejectForm();
            });

            // binding reject buttons
            $('.pdf-field .reject-btn').click(function() {
                var field = $(this).closest('.pdf-field');
                toggleFieldExpand(field);
                field.addClass('marked rejected');
                updateApproveRejectForm();
            });

            // binding global approve button
            $('.fsi-pdf-approve-reject .approve-btn').click(function() {
                alert('Document approved.');
            });
            // binding global reject button
            $('.fsi-pdf-approve-reject .reject-btn').click(function() {
                alert('Document rejected with message: ' + $('.fsi-pdf-approve-reject textarea').val());
            });

        });
    </script>